**目录：**

- [1. HTML5 简介](#1-html5-简介)
  - [1.1. HTML5 的故事](#11-html5-的故事)
    - [1.1.1. XHTML 1.0：更严格的标准](#111-xhtml-10更严格的标准)
    - [1.1.2. XHTML 2：意想不到的失败](#112-xhtml-2意想不到的失败)
    - [1.1.3. HTML5：起死回生](#113-html5起死回生)
    - [1.1.4. HTML：活着的语言](#114-html活着的语言)
  - [1.2. HTML5 的三个主要原理](#12-html5-的三个主要原理)
    - [1.2.1. 不破坏 Web](#121-不破坏-web)
    - [1.2.2. 修补牛蹄子路](#122-修补牛蹄子路)
    - [1.2.3. 实用至上](#123-实用至上)
  - [1.3. HTML5 标记初体验](#13-html5-标记初体验)
    - [1.3.1. HTML5 文档类型](#131-html5-文档类型)
    - [1.3.2. 字符编码](#132-字符编码)
    - [1.3.3. 页面语言](#133-页面语言)
    - [1.3.4. 添加样式表](#134-添加样式表)
    - [1.3.5. 添加 JavaScript](#135-添加-javascript)
    - [1.3.6. 最终结果](#136-最终结果)
  - [1.4. HTML5 语法](#14-html5-语法)
    - [1.4.1. 放松的规则](#141-放松的规则)
    - [1.4.2. HTML5 验证](#142-html5-验证)

# 1. HTML5 简介

如果说 HTML 是一部电影，那 HTML5 就是一次大转折。HTML 本来是不会活过 21 世纪的。官方 Web 标准组织 W3C 早在 1998 年就已经对 HTML 撒手不管了。W3C 把未来都寄托在 XHTML 这个更具现代特色的后续标准身上，XHTML 被视为 HTML 的严肃整洁版。 但 XHTML 举步维艰，是一群被剥夺了话语权的人，让 HTML 起死回生并为本书将要探讨的功能奠定了基础。

在本章里，你会了解 HTML 死亡的原因，以及它又是怎样复活的；了解 HTML5 的设计原理与功能；还将见识恼人的浏览器支持问题。在这一章，你将第一次看到真正的 HTML5 文档。

## 1.1. HTML5 的故事

HTML 的基本思想——使用元素为内容添加结构——从 Web 诞生以来就没有变过。事实上，即使是最陈旧的网页，在最新的浏览器中仍然可以得到完美的呈现。

年长和成功也会带来风险，那就是所有人都想取代你！1998 年，W3C 停止了对 HTML 的维护，作为对它的改进，开始制定一个基于 XML 的后续版本——XHTML 1.0。

### 1.1.1. XHTML 1.0：更严格的标准

XHTML 与 HTML 的语法绝大部分都是相同的，只不过要求更严格。很多以前不够严谨的 HTML 标记，在 XHTML 中都变成了不能接受的。

例如，假设你想把标题中的最后一个词标记为斜体，本来应该写：

```html
<h1>
  The Life of a
  <i>Duck</i>
</h1>
```

但你一不小心放错了最后两个标签的位置：

```html
<h1>The Life of a <i>Duck</h1></i>
```

浏览器在遇到这个稍微有点乱的标记之后，能明白你想干什么。于是，它就一声不吭地把最后一个词变成斜体。可是，标签不匹配违反了 XHTML 的规定。如果把页面复制到一个 XHTML 验证器中（或使用 Dreamweaver 之类的网页设计工具时），你就会看到一个警告，告诉你哪里有错误。从 Web 设计的角度看，XHTML 基于严格规则的这种提示很有用，因为你可以发现微小的错误，这些错误会导致在不同浏览器中显示结果不一致（这些错误在编辑和增强页面时还可能导致更严重的问题）。

最初，XHTML 获得了成功。由于厌倦了浏览器的古怪行为和怎么写都可以通过的不正常状态，专业的 Web 开发人员对 XHTML 还是非常拥护的。后来，XHTML 标准又强迫他们养成更好的习惯，同时放弃 HTML 中那些并不完善的格式化功能。可是，与 XML 工具协同，降低自动化程序处理页面的难度，方便地移植到移动平台，以及 XHTML 语言自身的可扩展性等这些预期的好处，从来没有在 XHTML 身上实现过。

即便如此，XHTML 仍然成为最严肃的 Web 设计师所遵循的标准。尽管看起来所有人都挺满意的，但实际上却存在一个潜规则：浏览器虽然理解 XHTML 标记，但却不会严格地按照标准执行错误检查。这就意味着页面仍然可以不遵守 XHTML 规则，浏览器则视而不见。事实上，没有什么可以阻止 Web 开发人员把乱糟糟的标记和陈旧的 HTML 内容混在一起，然后还说这是 XHTML 页面。世界上根本就没有一个浏览器站出来反对这种行为。这种情况让那些负责 XHTML 标准的人深感不安。

### 1.1.2. XHTML 2：意想不到的失败

解决方案就是通过 XHTML 2 来扭转这个乱糟糟的局面。这个新版本规定了严格的错误处理规则，强制要求浏览器拒绝无效的 XHTML 2 页面，同时也摒弃了很多从 HTML 沿袭下来的怪异行为和编码惯例。比如，以编号方式（`<h1>`、`<h2>`、`<h3>`等）区分标题的方法被一个新的`<h>`元素取代，这个元素的重要性取决于它在网页中的位置。类似地，由于允许 Web 开发人员将任何元素转换为链接，`<a>`元素的地位一落千丈。而`<img>`元素因为增加了一种提供替代内容的新方式，也丧失了原有的 alt 属性。

这些变化是 XHTML 2 的典型特征。从理论上看，这些改变的目的是让网页更整洁也更有逻辑性。而从实践角度说，这就要求 Web 设计人员必须改变以前编写网页的方式（已经存在的网页必须更新），但付出这些代价却没有增加任何新功能，让这种改变失去了价值。与此同时，XHTML 2 还宣布作废了几个众所周知的元素，比如用于加粗文本的`<b>`、用于变斜体的`<i>`和用于在网页中嵌入另一个网页的`<iframe>`，但这些元素在 Web 设计人员中仍然深得人心。

但最糟糕的，还是慢得要死的制定过程。XHTML 2 的制定过程整整拖了 5 年才完成，开发人员的激情早已荡然无存了。

### 1.1.3. HTML5：起死回生

几乎与此同时，从 2004 年开始就有一群人从另外一个角度展望 Web 的未来。他们想的不是从 HTML 中挑出各式各样的毛病（或者干脆说是主张“不纯粹的哲学观”），而是它还缺少什么 Web 开发人员编码时急需的功能。

归根结底，HTML 最早是作为显示文档的手段出现的。辅之以 JavaScript，它其实已经演变成了一个系统，可以开发搜索引擎、网上商店、在线地图、邮件客户端以及其他各种能够想象得到的 Web 应用。虽然设计巧妙的 Web 应用可以实现很多令人赞叹的功能，但开发这样的应用远非易事。多数 Web 应用都得手动编写大量 JavaScript 代码，还要用到一个或多个流行的 JavaScript 工具包，乃至在 Web 服务器上运行的服务器端模块。要让所有这些方面在不同的浏览器中都能紧密配合不出差错是一个挑战。即使是赢得了挑战，你还要记住把这些方面联系到一起的那些错综复杂的细节。

开发浏览器的人对这种情况特别关注。于是，来自 Opera Software（开发 Opera 浏览器的公司）和 Mozilla Foundation（开发 Firefox 浏览器的组织）的一些具有超前意识的人纷纷建言，希望 XHTML 能加入一些对开发人员更有用的功能。但他们的建议并没有被采纳，结果 Opera、Mozilla 和苹果公司自发地组建了 WHATWG（Web Hypertext Application Technology Working Group，Web 超文本应用技术工作组），致力于寻找新的解决方案。

WHATWG 的目的不是抛弃 HTML，而是考虑以无障碍、向后兼容的方式去扩展它。这个组织最早的工作成果包含两个补充规范：Web Application 1.0 和 Web Forms 2.0。而 HTML5 正是在这两个标准的基础上发展起来的。

注意 HTML5 中的数字 5 表示这个标准是 HTML 的后续版本（在 XHTML 之前，HTML 的版本号是 4.01）。当然，这个解释也不完全正确，因为 HTML5 支持自 HTML 4.01 发布以来的 10 年间出现在网页中的所有新东西，包括严格的 XHTML 风格的语法（只要你愿意就可以用）和大量的 JavaScript 创新。但不管怎么说，这个名字仍然清楚地表明：HTML5 虽然支持 XHTML 的规定，但它要求的则是 HTML 的规则。

2007 年，WHATWG 获得了全球 Web 开发人员空前的支持。痛定思痛之后，W3C 宣布解散负责制定 XHTML 2 标准的工作组，并开始致力于将 HTML5 改造为正式的标准。就这样，最初的 HTML5 被分割成多个容易管理的模块，而本来统称为 HTML5 的很多功能分散到了几个独立的标准中（更多信息，请详见后面的附注栏）。

提示 W3C 官方 HTML5 标准的网址是 http://www.w3.org/TR/html5。

**HTML5 包含哪些功能**

HTML5 包含多个标准，这些标准之间彼此关联。这种局面既好又不好。说好，是因为浏览器可以迅速实现 HTML5 中业已成熟的部分，而任由其他部分继续发展。说不好，则是因为编写网页的人必须检查浏览器是否支持自己想用的功能。本书将会介绍一些检测浏览器的技术，有的很麻烦，有的则没有那么麻烦。

以下列出了 HTML5 涵盖的一些主要功能。

- HTML5 核心。这一部分主要由 W3C 官方的规范组成，涉及新的语义元素（第 2 章和第 3 章）、新的增强的 Web 表单微件（第 4 章）、音频和视频支持（第 5 章）以及通过 JavaScript 绘图的 Canvas（第 8 章和第 9 章）。
- 曾经属于 HTML5 的功能。这一部分源自 WHATWG 最初制定的 HTML5 规范，其中大多数功能需要 JavaScript 且支持富 Web 应用开发。最重要的包括本地数据存储（第 10 章）、离线应用（第 11 章）和消息传递（第 12 章），但本书要介绍的内容还不止这些。
- 有时候会被称为 HTML5 的功能。这些通常是指下一代功能，虽然它们从未进入过 HTML5 标准，但人们还是经常会把它们与 HTML5 相提并论。这部分包括 CSS3（第 6 章和第 7 章）和地理定位（第 13 章）。

甚至连 W3C 都在有意无意地模糊“真正的”HTML5（已有标准）和“宣传用”版本（包括 HTML5 的所有新增部分和补充规范）之间的界限。举个例子，官方 W3C 标志网站（www.w3.org/html/logo）鼓励人们生成用于宣传CSS3和SVG的HTML5标志，而前两个标准在HTML5出现之前就已经在开发了。

### 1.1.4. HTML：活着的语言

从 W3C 到 WHATWG，然后再回到 W3C，这个过程导致了相当罕见的转换与磨合。从技术上说，什么是或什么不是 HTML5 由 W3C 说了算。但与此同时，WHATWG 一直在设计未来的 HTML 功能。直到最近，他们才不再把自己的工作成果称为 HTML5，而是简单地称为 HTML，表明 HTML 还会继续活下去。

因为 HTML 是一门活着的语言，所以 HTML 页面永远不会作废，也不会无法阅读。HTML 页面永远不需要版本号（甚至连文档类型声明都不需要），Web 开发人员也永远不需要为了让它能在新浏览器中运行，而把自己的标记从一个版本“升级”到另一个版本。同样，任何时候在 HTML 标准中都可能增添新功能。

Web 开发人员听到这么说，第一反应通常是大惑不解。毕竟，谁希望浏览器对标准的支持各不相同，而谁又愿意在选择功能时只凭它们将来会得到支持这个可能性呢？然而，冷静下来想一想，大多数 Web 开发人员还是不情愿地接受了这个现实：无论如何，浏览器从 Web 诞生的那一天起始终都是这样的。

前面我们解释过，今天的浏览器乐于接受支持一大堆乱七八糟的功能这个现实。你可以在激进的 XHTML 页面中加上像`<marquee>`元素（用于创建滚动文本，已废弃）这样被认为是倒行逆施的东西，任何浏览器都不会反对。类似地，即便是在对最老标准的支持方面，有些浏览器也仍然存在一些广为人知的遗漏。比如，有些浏览器开发商在完整地支持 CSS2 之前就开始实现 CSS3，结果很多 CSS2 特性后来都没有实现。唯一的区别就是 HTML5 现在把“活着的语言”变成了常规状态。同样，就像我们正在用新的、创新性的一章来介绍 HTML 一样，它经过了一番轮回终于又恢复了它的本来面貌，这不也正是一个天大的讽刺吗？

提示 要了解当下正在发展中的 HTML，包括被称为 HTML5 的部分和少量但始终在变化的、新的、还没有得到支持的功能，请访问http://whatwg.org/html。

## 1.2. HTML5 的三个主要原理

此时此刻，有的读者可能已经按捺不住了，迫不急待地想知道真正的 HTML5 页面到底是什么样子的。不过在此之前，有必要先了解一下制定 HTML5 规范的那些人当时是怎么想的。只有理解了这门语言背后的设计思想，才能真正明白本书将要介绍的那些古怪的行为、复杂的现象和偶尔会让人抓耳挠腮的问题。

### 1.2.1. 不破坏 Web

“不破坏 Web”的意思是标准不应该引入导致已有的网页无法工作的改变。幸运的是，这种事故极少发生。

“不破坏 Web”还意味着标准不应该出人意料地更改规则，不能认定今天还完美无缺的网页到了明天就要作废（即使可以使用也要作废）。比如，XHTML 2 破坏了 Web，因为它要求马上就显著改变以前编写网页的方式。没错，原来的网页还能用，但那都是浏览器支持向后兼容的功劳。如果你为将来打算，想按照最新标准重写网页，就得浪费数不清的时间去纠正 XHTML 2 已经明令禁止的“错误”。

HTML5 的立场不一样。HTML5 之前可以接受的，在 HTML5 中照样可以接受。事实也是，符合 HTML 4.01 标准的网页在 HTML5 中仍然是有效的。

注意 与以往的标准不同，HTML5 不仅向浏览器开发商明示该支持什么，还利用文档说明并规范化了它们原来的处理方式。由于 HTML5 标准描述的都是事实，而不是抛出一堆理想的规则了事，因此它有望成为有史以来受支持程度最高的 Web 标准。

**HTML5 怎么处理废弃元素**

因为 HTML5 支持所有 HTML，所以它支持很多被认为是废弃的功能。其中包括像`<font>`这样的格式化元素，被人厌恶的`<blink>`和`<marquee>`等特效元素，以及难对付的 HTML 框架体系。

这种无所不包的开放性是令很多 HTML5 新手感到困惑的一个原因。一方面，HTML5 无论如何还是应该禁止使用这些过时的元素，因为它们已经很多年没有出现在官方规范里了。另一方面，现代浏览器依然悄无声息地支持着这些元素，而 HTML5 就是要体现浏览器真实的处理方式。那么这个标准到底要怎么做呢？

为解决这个问题，HTML5 规范包含两个独立的部分。第一部分（也是本书将要介绍的）面向 Web 开发人员，要求摒弃过去的那些坏习惯和被废弃的元素。通过使用 HTML5 验证器可以确保遵循 HTML5 标准的这一部分。

第二部分，也是 HTML5 规范中篇幅更长的部分，针对的是浏览器开发商。它们需要支持 HTML 中存在的一切，以做到向后兼容。理想情况下，HTML5 标准中应该包含足够的信息，让人能够据以从头开发一个新浏览器，而且无论是处理新的还是旧的标记，该浏览器都应该能够与今天的现代浏览器完全兼容。这一部分标准就是告诉浏览器如何处理那些官方不鼓励使用但仍然必须支持的废弃元素。

有时候，HTML5 规范也会对浏览器应如何处理各种错误（如漏写或错配了标签）作出正式规定。这一点其实很重要，因为它可以确保有缺陷的页面在不同浏览器中都能够得到同样的处理，甚至都规定了将页面映射为 DOM（Document Object Model，文档对象模型，即内存中表现页面元素的对象树，供 JavaScript 使用）这么细节的问题。为了写出标准的这个冗长又乏味的部分，HTML5 的制定者们在现代浏览器上进行了彻底的测试，以便发现还没有作出规定的错误处理行为。然后再把该行为加到标准中。

### 1.2.2. 修补牛蹄子路

牛蹄子路（cowpath）指的是高低不平但使用频率很高的路，通过它可以从一个地方到达另一个地方。之所以存在牛蹄子路，就是因为有人走。也许这条路走起来不是最舒服的，但某种程度上却是最实际的解决之道。

HTML5 标准化了这些非官方（但广泛应用）的技术。或许与利用新方法修的高速公路相比，牛蹄子路没有那么平坦宽阔，但它赢得胜利的机会更大。因为对于一般的网站设计人员来说，切换到新技术可能会超出他们的能力范围，或者他们根本就没有兴趣。更大的问题在于，使用旧浏览器的访客无法因为新技术而受益。XHTML 2 企图把人们赶出牛蹄子路，结果败得非常惨。

注意 修补牛蹄子路有一个明显的好处：它使用已经得到浏览器某种程度支持的既定技术。假设有一种只被七成浏览器支持的漂亮的新技术，还有一种任何情况都能工作但不那么雅观的 hack，Web 开发人员始终都会选择不那么雅观的 hack，因为它适合更多的用户。

“修补牛蹄子路”的方法也需要折中。有时候，这意味着要包容那些得到广泛支持但设计却很拙劣的功能。HTML5 的拖放就是一个例子（参见 10.3.5 节），这个功能完全以微软为 IE5 设计的拖放机制为基础。尽管这个拖放功能目前得到了所有浏览器的支持，但由于使用起来不灵活而且过度复杂，因此几乎没有人不反感它。为此，不少的 Web 设计人员也抱怨“HTML5 不仅鼓励不良行为，而且还给它们正名。”

### 1.2.3. 实用至上

这个原理很简单：改变应该以实用为目的。改变得越多，代价也就越大。Web 开发人员可能更希望标准是精心设计、始终如一，而且是没有怪异行为的。但这个理由还不足以改变一门已经用来创建了数十亿网页的语言。当然，到底需要不需要改变还是要由某个人根据利害来评判。而现有网页都是怎么做的或者说试图怎么去做，可以作为很好的判断依据。

例如，（在本书写作时）YouTube 是世界上第三受欢迎的网站，但由于 HTML5 之前的 HTML 不真正支持视频，YouTube 一直都得依赖 Flash 插件。使用 Flash 插件没什么问题，因为只要是能上网的计算机，基本上都会安装这个插件。不过也有例外，比如某些公司会锁定它们的计算机，不允许安装 Flash，另外一些移动设备（如 iPhone、iPad 和 Kindle）也不支持 Flash。不管有多少计算机安装了 Flash，扩展 HTML 标准，使其直接支持人们今天使用 Web 的一种最基本方式——看视频，毋庸置疑是有必要的。

而 HTML5 中添加了更多交互功能的背后也有着同样的动机。像拖放、可编辑的 HTML 内容、在 Canvas 中绘制二维图形等，都是同样的情况。这些功能在我们身边的网页中并不鲜见，只不过有的通过 Adobe Flash 或微软 Silverlight 等插件实现，而有的则是利用 JavaScript 库或（更艰苦地）完全通过手工编写 JavaScript 代码来实现。因此，为什么不在 HTML 标准中加入官方的支持，让这些功能在所有浏览器中都能一致地工作呢？HTML5 正是要这么做。

注意 Flash 等浏览器插件不会一夜之间就消失。尽管 HTML5 有很多创新，但通过它来构建复杂的图形界面应用，仍然不是件轻而易举的事。不过，HTML5 的终极目标很清楚：让网站不依赖插件也能够提供视频、丰富的交互功能以及各种漂亮的效果。

## 1.3. HTML5 标记初体验

下面是一个最简单的 HTML5 文档。

```html
<!DOCTYPE html>
<title>A Tiny HTML Document</title>
<p>Let's rock the browser, HTML5 style.</p>
```

开始是 HTML5 的文档类型声明（下一节会详细介绍），然后是页面标题和一些内容。在这里，内容是包含在一个段落中的文本。

想必读者已经知道它在浏览器中是个什么样子了，不过为了验证你的直觉，可以参考图 1-1。

![1-1-简单的html5文档](illustrations/1-1-简单的html5文档.png)

甚至还可以进一步给这个文档瘦身。比如，HTML5 标准不要求必须有最后面那个`</p>`标签，因为浏览器知道在文档后面要关闭所有没有关闭的标签（HTML5 标准规定浏览器必须这样处理）。可是，这种简单的写法会让标记显得很乱，甚至可能导致意料之外的错误。

如果有其他方式提供标题信息，HTML5 标准也允许你省略`<title>`元素。比如，在通过电子邮件发送 HTML 文档时，可以把标题放在邮件的标题中，而把其他标记（文档类型声明以及内容）放在邮件的正文里。不过，这很明显是一种特例。

更常见的情况，则是充实这个已经瘦骨嶙峋的 HTML5 文档。大多数 Web 开发人员都认为使用`<head>`和`<body>`来分块可以避免导致混乱，因为可以把关于页面的信息（头部）与页面的实际内容（主体）分开。在为页面添加脚本、样式表和元数据的时候，这种结构特别实用：

```html
<!DOCTYPE html>
<head>
  <title>A Tiny HTML Document</title>
</head>
<body>
  <p>Let's rock the browser, HTML5 style.</p>
</body>
```

当然，代码中的缩进不是必需的。这里使用缩进就是为了让人一眼就能看清楚页面结构。

最后，还可以选择用`<html>`元素来封装整个文档（不包含文档类型声明那一行）。结果就成了这样：

```html
<!DOCTYPE html>
<html>
  <head>
    <title>A Tiny HTML Document</title>
  </head>
  <body>
    <p>Let's rock the browser, HTML5 style.</p>
  </body>
</html>
```

在 HTML5 以前，所有版本的 HTML 官方规范都要求使用`<html>`元素，而实际上用不用它对浏览器来说是无所谓的。HTML5 则规定可用可不用。

注意 使不使用`<html>`、`<head>`和`<body>`元素只代表一种风格。即便是在 HTML5 诞生之前就已经存在的浏览器中，不用这些元素，页面照样可以完美呈现。事实上，浏览器会自动假设页面中已经包含了这些元素。因此，如果用 JavaScript 来查询 DOM（表示页面中元素的一组对象，可以通过编程方式访问），仍然能够找到`<html>`、`<head>`和`<body>`元素，无论你实际上加了还是没加。

现在，这个示例比最简单的 HTML5 文档复杂一些，但比真正实用的 HTML5 网页又简单一些。接下来的几节，我们会陆续向其中加入新内容，同时也对标记进行简单介绍。

### 1.3.1. HTML5 文档类型

每个 HTML5 文档的第一行都必须是一个特定的文档类型声明。这个文档类型声明用于宣告后面的文档标记遵循哪个标准。以下文档声明表示文档标记遵循 HTML5 标准：

```html
<!DOCTYPE html>
```

HTML5 的文档类型声明给人的第一印象就是极其简单。特别是与冗长的 XHTML 1.0 严格型的文档类型声明相比，这一点更明显：

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
```

面对如此复杂的 XHTML 文档类型声明，就连专业的 Web 开发人员也不得不采用复制粘贴的方法。相比之下，HTML5 的文档类型声明简约至上，手工输入也不麻烦。

另外，HTML5 的文档声明还有一点值得注意，那就是它不包含官方规范的版本号（即 HTML5 中的 5）。事实上，这个声明仅仅表明当前页面是 HTML 页面。这与 HTML5 作为一门活着的语言（见 1.1.4 节）的远见是分不开的。换句话说，只要有新功能添加到 HTML 语言中，你在页面中就可以使用它们，而不必为此修改文档类型声明。

由此，不少读者可能都会提出一个问题：既然 HTML5 是一门活语言，那为什么还要求网页中有这个所谓的文档类型声明呢？

要求保留文档类型声明，主要是由于历史原因。如果没有文档类型声明，那大多数浏览器（包括 Internet Explorer 和 Firefox）将转换到一种 **混杂模式(quirk mode)**。

IE5.5 引入了文档模式（document mode）的概念，这个概念是通过切换文档类型声明实现的。最初的两种文档模式是：混杂模式和标准模式。混杂模式会让 IE 的行为与（包含非标准特性的）IE5 相同，而标准模式则让 IE 的行为更接近标准行为。虽然这两种模式主要影响 CSS 内容的呈现，但在某些情况下也会影响到 JavaScript 的解释执行。

在这种模式下，浏览器会尝试根据有点不那么正常的规则呈现网页（那些规则是在浏览器的老版本中使用的）。而问题是，不同浏览器的混杂模式也不一样，因此为一种浏览器设计的页面到了另一个浏览器中，不是字体大小不一样，就是布局上有瑕疵，或者出现其他不一致的问题。

而在添加了文档类型声明后，浏览器就知道你想要使用更严格的 **标准模式(standard mode)**，在这种模式下，所有现代浏览器都会以一致的格式和布局来显示网页。浏览器不关心你使用的是哪种文档类型（个别情况下还有些例外），只要它检查到你有某种文档类型声明就好。HTML5 的文档类型声明是最短的有效文档类型声明，因此它总是能触发标准模式。

提示 HTML5 的文档类型声明可以触发所有具备标准模式的浏览器的标准模式，包括那些对 HTML5 一无所知的浏览器。为此，从现在开始，你可以在任何网页中都使用 HTML5 文档类型声明，即便使用很少得到支持的 HTML5 功能也没问题。

虽然文档类型声明主要的目的是告诉浏览器去做什么，但其他代理也可以检测该声明，比如，HTML5 验证器、搜索引擎、设计工具，还有人——在想知道你当初在页面中想写什么样的标记时。

### 1.3.2. 字符编码

字符编码是一种标准，计算机根据它把文本转换成保存在文档中的字节序列（或者在打开文件时再将字节序列转换成文本形式）。由于历史原因，现有的编码标准有很多种。但实际上，所有英文网站今天都在使用一种叫 UTF-8 的编码，这种编码简洁、转换速度快，而且支持任何你想要的非英文字符。

一般来说，经过配置的 Web 服务器会告诉浏览器它提供的网页采用了什么编码。但除非是你自己配置的 Web 服务器，否则这一步始终是不确定的。由于浏览器在猜测网页编码的时候可能会引发一些说不清的安全问题，因此最好在自己的标记中也加上编码信息。

在 HTML5 文档中添加字符编码信息也很简单。只要像下面这样在`<head>`区块的最开始处（如果没有添加`<head>`元素，则是紧跟在文档类型声明之后）添加相应的`<meta>`元素即可：

```html
<head>
  <meta charset="utf-8" />
  <title>A Tiny HTML Document</title>
</head>
```

Dreamweaver 等设计工具在创建新网页时会自动添加这个元信息，它们也会确保将文件保存为 UTF 编码格式。不过，如果你使用的是简单的文本编辑器，那就还要自己选择将文件保存为正确的格式。比如，使用 Windows 中的记事本程序编写 HTML 页面后，必须在“保存为”对话框下方的“编码”列表中选择“UTF-8”。而在使用 Mac OS 中的 TextEdit 时，首先需要选择“格式 ”
“生成纯文本”，以确保程序将页面保存为纯文本，然后必须再从“保存为”对话框的“纯文本编码”弹出菜单中选择“Unicode(UTF-8)”。

### 1.3.3. 页面语言

指明网页中使用的自然语言是一种好习惯。这个信息有时候对其他人有用，比如搜索引擎可
以通过它来筛选搜索结果，确保只向搜索者返回页面语言与他使用的语言相同的页面。

为给内容指定语言，可以在任何元素上使用 lang 属性，并为该属性指定相应的语言代码（比如，en 表示英语，zh-Hans 表示简体中文）。各国的语言代码可以在这里查到：https://www.w3schools.com/tags/ref_language_codes.asp。为整个页面添加语言说明的最简单方式，就是为`<html>`元素指定 lang 属性：

```html
<html lang="en"></html>
```

如果页面中包含多种语言的文本，那么这个细节信息对屏幕阅读器也是很有用的。在这种情况下，可以为文本中的不同区块指定 lang 属性，指明该区块中文本的语言（例如，可以给包含不同语言文本的`<div>`元素指定不同的 lang 属性）。这样，屏幕阅读器就可以选择朗读适当的文本了。

### 1.3.4. 添加样式表

只要是经过特意设计的专业网站，就一定会使用样式表。指定想要使用的 CSS 样式表时，需要在 HTML5 文档的`<head>`区块中添加`<link>`元素，例如：

```html
<head>
  <meta charset="utf-8" />
  <title>A Tiny HTML Document</title>
  <link href="styles.css" rel="stylesheet" />
</head>
```

这跟向传统的 HTML 文档中添加样式表大同小异，但稍微简单一点。

注意 因为 CSS 是网页中唯一可用的样式表语言，所以网页中过去要求的 type="text/css"属性就没有什么必要了。

### 1.3.5. 添加 JavaScript

JavaScript 最早是为了给网页添加一些闪光点和吸引力才出现的，不过编写起来比较费时间。今天，JavaScript 的主要用途不再是装饰用户界面，而是开发新奇的 Web 应用，包括在浏览器中运行的极其先进的电子邮件客户端、文字处理程序，以及地图引擎。

在 HTML5 页面中添加 JavaScript 与在传统页面中添加差不多，下面就是一个引用外部 JavaScript 代码文件的示例：

```html
<head>
  <meta charset="utf-8" />
  <title>A Tiny HTML Document</title>
  <script src="scripts.js"></script>
</head>
```

没有必要加上 language="JavaScript"属性。浏览器会假定你想要使用 JavaScript，除非你想使用其他脚本语言，因为 JavaScript 是唯一被浏览器广泛支持的 HTML 脚本编写语言，所以你不会指定其他语言。不过，即使是引用外部 JavaScript 文件，也不能忘了后面的`</script>`标签。假如你不写这个标签，或者使用空元素语法想缩短标记，页面将不会执行加载脚本。

如果你在 Internet Explorer 中要花大量时间测试包含 JavaScript 的页面，还应该在`<head>`区块中包含一行特殊的注释，叫做 **Web 标志(mark of the Web)**，参见：：http://msdn.microsoft.com/zh-cn/library/ms537628(v=vs.85).aspx；这行注释要放在指定字符编码的元数据标签后面，如下所示：

```html
<head>
  <meta charset="utf-8" />
  <!-- saved from url=(0014)about:internet -->
  <title>A Tiny HTML Document</title>
  <script src="scripts.js"></script>
</head>
```

这条注释告诉 Internet Explorer 将页面视为从远程网站上下载下来的。否则，IE 会切换到一种特殊的锁定模式，弹出一条安全警告，在你点了“允许阻止的内容”按钮之后才会执行 JavaScript 代码。

其他所有浏览器都会忽略这个“Web 标志”注释，对远程站点和本地文件使用相同的安全设置。

### 1.3.6. 最终结果

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>A Tiny HTML Document</title>
    <link href="styles.css" rel="stylesheet" />
    <script src="scripts.js"></script>
  </head>
  <body>
    <p>Let's rock the browser, HTML5 style.</p>
  </body>
</html>
```

虽然这不再是一个最短的 HTML5 文档，但以它为基础可以构建出任何网页。这个例子本身没什么可圈可点之处，不过在下一章创建真实网页的过程中，我们会为内容精心设计布局并通过 CSS 应用样式。

注意 本节介绍的所有 HTML5 语法——新的文档类型声明、声明字符编码的元数据元素、语言信息属性和引用样式表及 JavaScript 标签，同时适用于新旧浏览器。因为这些语法依赖于所有浏览器的默认行为和内置的纠错机制。

## 1.4. HTML5 语法

如前所述，HTML5 放松了某些规则。这是因为 HTML5 的制定者想让这门语言更紧密地反映浏览器的现实。换句话说，他们想缩小“可以工作的网页”与“根据标准是有效的网页”之间的差距。接下来，我们就介绍一下 HTML5 改变的语法规则。

注意 没错，还有很多浏览器支持的老式做法被 HTML5 标准严格排除在外。要想在自己的见面中及时改正这些老毛病，需要用到 1.4.2 节介绍的 HTML5 验证器。

### 1.4.1. 放松的规则

在初次体验 HTML5 文档之后，我们知道 HTML5 并不要求网页中必须包含`<html>`、`<head>`和`<body>`元素（尽管它们的存在有时候非常有用）。但 HTML5 的轻松态度还不止于此。

HTML5 不区分大小写，因此类似下面这样的标记是没有问题的：

```html
<p>
  Capital and lowercase letters
  <em>don't matter</em>
  in tag names.
</p>
.
```

HTML5 还允许省略关闭 **空元素(void element)** 的斜杠；所谓空元素，就是不会嵌套内容的元素，如`<img>`（图像）、`<br>`（换行）或`<hr>`（水平线）。以下是三种添加换行的等价方式：

```html
I cannot
<br />
move backward
<br />
or forward.
<br />
I am caught
```

HTML5 也修改属性的语法规则。属性值中只要不包含受限的字符（比如>、=或空格），就可以不加引号。下面这个`<img>`元素就利用了这一点：

```html
<img alt="Horsehead Nebula" src="Horsehead01.jpg" />
```

只有属性名没有属性值也可以。虽然 XHTML 要求必须采用如下冗余的语法将复选框设置为选中状态：

```html
<input type="checkbox" checked="checked" />
```

但现在可以只包含属性名，回到 HTML 4.01 时代的传统短语法形式：

```html
<input type="checkbox" checked />
```

对某些人来说，HTML5 最令人担心的还不是这些。他们担心那些经常改变风格的开发人员会在严格的和松散的语法之间摇摆不定，特别是在一个文档内部也经常转换风格。可是，这种情况在 XHTML 时代同样存在。无论是严格还是松散，良好的风格都取决于 Web 设计师，而浏览器则会无条件地接受你扔给它的任何东西。

如果能做到如下几点（也是本书后续示例遵循的约定——尽管不是必须遵循的），基本上就可以算作良好的 HTML5 风格了。

- 包含可选的`<html>`、`<body>`和`<head>`元素。要给页面定义自然语言（见 1.3.3 节），`<html>`是最理想的地方；而`<body>`和`<head>`有助于将页面内容与其他页面信息分离。
- 标签全部小写（如用`<p>`而非`<P>`）。虽然不是必须这么做，但这种形式很常见，输入起来要轻松容易得多（因为不需要按 Shift 键），而且不会让人触目惊心。
- 为属性值加引号。加引号是有理由的——防止你在不经意间犯错。要知道，没有引号的话，一个无效字符就可能破坏整个页面。

不过，还有一些老的约定这里并没有列出来（你也可以忽略）。本书的示例不会关闭空元素，因为在基于 HTML5 编写代码时，大多数人都不屑于添加额外的斜杠（/）。类似地，在属性名与属性值相同的情况下，还一味地留恋长属性的形式也没有什么道理。

### 1.4.2. HTML5 验证

没准儿新的松散的 HTML5 语法让你觉得很舒服。没准儿，一想到欢快的浏览器背后可能隐藏着不一致的、到处都是错误的标记，你简直夜不能寐。如果你不幸是后一种情况，那么一定会高兴听到这个消息：有验证工具可以帮你抓住那些与 HTML5 推荐标准不相符的标记，甚至都不会惊扰浏览器。

以下就是 HTML5 验证器会关注的一些可能的问题：

- 缺少必需的元素（例如`<title>`元素）；
- 有开始标签但没有结束标签；
- 标签嵌套错误；
- 不包含必要属性的标签（例如没有 src 属性的`<img>`元素）；
- 元素或内容放错了地方（例如把文本直接放在了`<head>`区块中）。

Dreamweaver 等 Web 设计工具都有它们自带的验证器。如果你嫌麻烦，也可以使用在线验证工具，下面我们展示如何使用 W3C 标准组织提供的流行的验证器。

1. 在浏览器中，打开http://validator.w3.org（图1-2）。

![1-2-html5语法验证器](illustrations/1-1-简单的html5文档.png)

2. 单击相应的选项卡，提供 HTML 内容。

- “Validate by URI”可以验证已经存在的网页。只要在 Address（地址）框中输入页面的 URL 即可（例如http://www.mysloppysite.com/FlawedPage.html）。
- “Validate by File Upload”可以验证你电脑硬盘上的页面。首先，单击 Browse（浏览）按钮（在 Chrome 中单击 Choose File<选择文件>）。在“打开”对话框中，选择 HTML 文件并单击 Open（打开）。
- “Validate by Direct Input”可以验证任何标记——只要在大文本框里输入即可。从文本编辑器中直接把标记复制粘贴到 W3C 验证页面的文本框里是最简单的方式。

在继续之前，可以单击 More Options（更多选项）修改设置，不过一般不用。最好是让验证器自动检测文档类型，因为这样验证器会使用你在网页中指定的文档类型。类似地，除非你的页面中使用了不同的语言，而验证器无法确定正确的字符集，否则就用自动检测好了。

3. 单击 Check（检测）按钮。

这样就会把 HTML 页面发送到 W3C 验证器。稍微等一会儿，就会看到报告。你会看到自己的文档是否通过了验证，而如果失败的话，则会看到验证器检测到的错误。

注意 即便是验证之后没有发现一点问题的文档，验证器也会给出一些警告，包括字符编码是自动检测到的，HTML5 验证服务还处于试验阶段、还不完善，等等。
